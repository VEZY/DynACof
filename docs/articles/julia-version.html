<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the Julia version • DynACof</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the Julia version">
<meta property="og:description" content="">
<meta property="og:image" content="https://vezy.github.io/DynACof/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DynACof</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/julia-version.html">Using the Julia version</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using the Julia version</h1>
                        <h4 class="author">Rémi Vezy</h4>
            
      
      
      <div class="hidden name"><code>julia-version.Rmd</code></div>

    </div>

    
    
<p>DynACof is available as an R package (this one), but also as a <a href="https://julialang.org/">Julia</a> package for better performance (more than ~100x). The Julia package is available on <a href="https://github.com/VEZY/DynACof.jl">this repository</a>, and the documentation is available <a href="https://vezy.github.io/DynACof.jl/dev/">here</a>.</p>
<p>It is possible to use the Julia version from R with approximately the same command as it is for using the R version. Here we explain the different steps to get there.</p>
<div id="install-julia" class="section level2">
<h2 class="hasAnchor">
<a href="#install-julia" class="anchor"></a>Install Julia</h2>
<p>The first step is to install Julia on your computer. Follow this <a href="https://julialang.org/downloads/">link</a>, and install the current stable release (or at least &gt; v1.1). If you don’t know how, just click on “help” after the name of your OS and follow the instructions (e.g. <a href="https://julialang.org/downloads/platform.html#windows">here</a> for windows). After this operation, check that Julia is in your path. To do so, the simplest way is to open a terminal (or a cmd) and to simply type <code>julia</code>. If Julia is starting, then it must be in your path, else please <a href="http://letmegooglethat.com/?q=add+program+to+path">go to the internet</a> to find the way.</p>
</div>
<div id="setup-julia-from-r" class="section level2">
<h2 class="hasAnchor">
<a href="#setup-julia-from-r" class="anchor"></a>Setup Julia from R</h2>
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h3>
<p>Open R (or better, Rstudio), and load the DynACof R package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DynACof)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co">#&gt; Learn DynACof at: https://vezy.github.io/DynACof/</span></a></code></pre></div>
<p>Then, setup the Julia environment using <code><a href="../reference/dynacof.jl_setup.html">dynacof.jl_setup()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="../reference/dynacof.jl_setup.html">dynacof.jl_setup</a></span>()</a></code></pre></div>
<p>This command instantiate julia, download the required Julia packages, and precompile them. This step can take a while, especially if you have a slow connection and/or computer. You can expect to wait for 2-3 minutes the first time you execute this function, but next time the packages will be in your computer and precompiled already, so it is less time-consuming after the first time.</p>
<p>When you already ran <code><a href="../reference/dynacof.jl_setup.html">dynacof.jl_setup()</a></code> once on your computer, you can add <code>install=FALSE</code> to avoid unecessary computations:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="../reference/dynacof.jl_setup.html">dynacof.jl_setup</a></span>(<span class="dt">install=</span><span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="troubleshooting" class="section level3">
<h3 class="hasAnchor">
<a href="#troubleshooting" class="anchor"></a>Troubleshooting</h3>
<p>If you have some trouble executing the last step, you can do two things:</p>
<ul>
<li>If you changed your version of R try to run <code><a href="../reference/dynacof.jl_setup.html">dynacof.jl_setup(rebuild=TRUE)</a></code>;</li>
<li>If you have more troubles, try to install the Julia packages from Julia (see below).</li>
</ul>
<p>To install manually Julia packages, open Julia in a terminal (and not from an IDE like JuliaPro), and copy/paste these lines of code (and press enter):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb4-1" title="1">using Pkg</a>
<a class="sourceLine" id="cb4-2" title="2">Pkg.add([<span class="st">"RCall"</span>,<span class="st">"Suppressor"</span>,<span class="st">"DynACof"</span>])</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt;  Resolving package versions...</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt;   Updating `C:\Users\vezy\.julia\environments\v1.1\Project.toml`</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;  [no changes]</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt;   Updating `C:\Users\vezy\.julia\environments\v1.1\Manifest.toml`</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt;  [no changes]</span></a></code></pre></div>
<p>This command download the packages needed for a simulation. Then, execute this line of code:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb5-1" title="1">using RCall, Suppressor, DynACof</a></code></pre></div>
<p>It will pre-compile the packages on your computer, and will be much more informative than from R if it fails. If it fails, try to follow the indications (e.g. install other packages using <code>Pkg.add("Name of the package")</code>).</p>
</div>
<div id="some-details-about-juliacall" class="section level3">
<h3 class="hasAnchor">
<a href="#some-details-about-juliacall" class="anchor"></a>Some details about <code>JuliaCall</code>
</h3>
<p>If the previous step succeeded, R is now talking to Julia using the <a href="https://non-contradiction.github.io/JuliaCall/index.html">JuliaCall</a> package. You can check for fun that Julia is working by executing the following command:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">JuliaCall<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/JuliaCall/man/julia_command.html">julia_command</a></span>(<span class="st">"a= 1+1"</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#&gt; 2</span></a></code></pre></div>
<p>If it returns 2, it means that R sent the <code>"1+1"</code> command to Julia, that Julia evaluated it, and returned 2. Now we can ask to Julia to send back the value to R:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">b=<span class="st"> </span>JuliaCall<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/JuliaCall/man/julia_eval.html">julia_eval</a></span>(<span class="st">"a"</span>)</a>
<a class="sourceLine" id="cb7-2" title="2">b</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>Now R has the object <code>b</code> with a value of <code>2</code>.</p>
</div>
</div>
<div id="making-a-dynacof-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#making-a-dynacof-simulation" class="anchor"></a>Making a DynACof simulation</h2>
<div id="setting-up-the-parameters-and-the-meteorolorgy" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-the-parameters-and-the-meteorolorgy" class="anchor"></a>Setting up the parameters and the meteorolorgy</h3>
<p>We can use the example data to make a simulation. In <code>DynACof.jl</code>, the default parameter values in the model are the ones from Vezy et al. (2019), and we can download the meteorology from Github using these commands:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">met_file=<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="st">"https://raw.githubusercontent.com/VEZY/DynACof.jl_inputs/master/meteorology.txt"</span>,met_file)</a></code></pre></div>
<p>Now the meteorology file from Vezy et al. (2019) is downloaded on a temporary file.</p>
</div>
<div id="calling-dynacof" class="section level3">
<h3 class="hasAnchor">
<a href="#calling-dynacof" class="anchor"></a>Calling DynACof</h3>
<p>To make a simulation using <code>DynACof.jl</code>, use these commands:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">S=<span class="st"> </span><span class="kw"><a href="../reference/dynacof.jl.html">dynacof.jl</a></span>(<span class="dt">Inpath=</span> <span class="kw"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span>(met_file), <span class="dt">FileName=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Site=</span><span class="st">"package"</span>,<span class="dt">Meteo=</span><span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(met_file),<span class="dt">Soil=</span><span class="st">"package"</span>,<span class="dt">Coffee=</span><span class="st">"package"</span>,<span class="dt">Tree=</span><span class="ot">NULL</span>))</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co">#&gt;  Simulation completed successfully</span></a></code></pre></div>
<p>This command is making a simulation using the default parameters from the model, and the meteorology that we just downloaded. We can plot the LAI of the coffee now:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">bind_cols</span>(<span class="dt">Date=</span> S<span class="op">$</span>Meteo<span class="op">$</span>Date,<span class="dt">LAI=</span> S<span class="op">$</span>Sim<span class="op">$</span>LAI)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span> LAI, <span class="dt">x=</span> Date))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span><span class="kw">theme_tufte</span>()</a></code></pre></div>
<p><img src="julia-version_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
<div id="use-custom-input-files" class="section level2">
<h2 class="hasAnchor">
<a href="#use-custom-input-files" class="anchor"></a>Use custom input files</h2>
<p>Custom input files are available from the <a href="https://github.com/VEZY/DynACof.jl_inputs">DynACof.jl_inputs</a> repository. You can make a custom simulation after cloning the repository.</p>
<ul>
<li>Cloning into a temporary file (clone into a more permanent folder if you plan to use them more than once):</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># install.packages("git2r")</span></a>
<a class="sourceLine" id="cb11-2" title="2">dynacof_data=<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/normalizePath.html">normalizePath</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(<span class="dt">check =</span> <span class="ot">FALSE</span>),<span class="st">"repo"</span>), <span class="dt">winslash =</span> <span class="st">"/"</span>, <span class="dt">mustWork =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-3" title="3">git2r<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/git2r/man/clone.html">clone</a></span>(<span class="st">"https://github.com/VEZY/DynACof.jl_inputs.git"</span>,dynacof_data)</a></code></pre></div>
<ul>
<li>Making a simulation using the parameter files:</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">sim=<span class="st"> </span><span class="kw"><a href="../reference/dynacof.jl.html">dynacof.jl</a></span>(<span class="dt">Period =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1979-01-01"</span>, <span class="st">"1980-12-31"</span>)),</a>
<a class="sourceLine" id="cb12-2" title="2">                <span class="dt">Inpath =</span> dynacof_data, <span class="dt">Simulation_Name =</span> <span class="st">"Test1"</span>,</a>
<a class="sourceLine" id="cb12-3" title="3">                <span class="dt">FileName =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Site =</span> <span class="st">"site.jl"</span>, <span class="dt">Meteo =</span><span class="st">"meteorology.txt"</span>,</a>
<a class="sourceLine" id="cb12-4" title="4">                                <span class="dt">Soil =</span> <span class="st">"soil.jl"</span>,<span class="dt">Coffee =</span> <span class="st">"coffee.jl"</span>, <span class="dt">Tree =</span> <span class="ot">NULL</span>))</a></code></pre></div>
</div>
<div id="microbenchmark" class="section level2">
<h2 class="hasAnchor">
<a href="#microbenchmark" class="anchor"></a>Microbenchmark</h2>
<p>The R version takes usually about 9 or 10 minutes to execute the full example. Let’s see how much time it takes in average to make a simulation with the Julia version (making 10 simulations):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(microbenchmark)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4">a=<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">DynaCof=</span> <span class="kw"><a href="../reference/dynacof.jl.html">dynacof.jl</a></span>(<span class="dt">Inpath=</span> <span class="kw"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span>(met_file), <span class="dt">FileName=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Site=</span><span class="st">"package"</span>,<span class="dt">Meteo=</span><span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(met_file),<span class="dt">Soil=</span><span class="st">"package"</span>,<span class="dt">Coffee=</span><span class="st">"package"</span>,<span class="dt">Tree=</span><span class="ot">NULL</span>)), <span class="dt">times=</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-23" title="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-25" title="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-26" title="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-27" title="27"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-28" title="28"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-30" title="30"><span class="co">#&gt;  Simulation completed successfully </span></a>
<a class="sourceLine" id="cb13-31" title="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-32" title="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-33" title="33"><span class="co">#&gt;  Simulation completed successfully</span></a>
<a class="sourceLine" id="cb13-34" title="34"></a>
<a class="sourceLine" id="cb13-35" title="35"><span class="kw">autoplot</span>(a) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fl">2.0</span>,<span class="fl">4.0</span>)</a>
<a class="sourceLine" id="cb13-36" title="36"><span class="co">#&gt; Coordinate system already present. Adding new coordinate system, which will replace the existing one.</span></a>
<a class="sourceLine" id="cb13-37" title="37"><span class="co">#&gt; Scale for 'y' is already present. Adding another scale for 'y', which</span></a>
<a class="sourceLine" id="cb13-38" title="38"><span class="co">#&gt; will replace the existing scale.</span></a></code></pre></div>
<p><img src="julia-version_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Incredible! It makes a simulation in about 3 seconds in average! It is more than 100x faster than the pure R version.</p>
</div>
<div id="calling-dynacof-step-by-step" class="section level2">
<h2 class="hasAnchor">
<a href="#calling-dynacof-step-by-step" class="anchor"></a>Calling DynACof step by step</h2>
<p>By default DynACof starts a simulation from seedlings, but sometimes it is usefull to intialize a simulation at a given state. To do so, we can use the function <code><a href="../reference/dynacof_i.jl.html">dynacof_i.jl()</a></code>. This function takes a pre-initialized simulation in input, and make a simulation for given days only.</p>
<p>Given the large number of variables to initialize, the simplest way to initialize a simulation is to make a dummy one with the same parameters and meteorology than desired. For that matter, let’s use our previous simulation output: <code>S</code> (see “Calling DynACof”).</p>
<p>Let’s say that the first 99 days of simulation correspond to what we needed, but that we want to simulate an event of disease on day 100 by reducing the LAI. What we can do is to take the previous simulation <code>S</code>, remove some leaf mass (<code>CM_Leaf</code>) on day 100, and re-do the computation for one day:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">S<span class="op">$</span>Sim<span class="op">$</span>CM_Leaf[<span class="dv">100</span>]</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="co">#&gt; [1] 13.16375</span></a></code></pre></div>
<p>The leaf C mass is equal to 13.1637482. Let’s reduce it by 25%:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">S<span class="op">$</span>Sim<span class="op">$</span>CM_Leaf[<span class="dv">100</span>]=<span class="st"> </span>S<span class="op">$</span>Sim<span class="op">$</span>CM_Leaf[<span class="dv">100</span>] <span class="op">*</span><span class="st"> </span>(<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.25</span>)</a></code></pre></div>
<p>Now the leaf C mass is equal to 9.8728111. But all other variables are impacted by this one on the next day because it is used to compute the <code>LAI</code> that helps compute many things afterwards (light interception, then GPP…) !</p>
<p>Before running the new simulation, the LAI on day 101 is equal to 0.3118927 and CM_Leaf is equal to: 13.3427444.</p>
<p>Let’s see what is the impact of this disease on the coffee plant by re-simulating the day 101:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">S_disease=<span class="st"> </span><span class="kw"><a href="../reference/dynacof_i.jl.html">dynacof_i.jl</a></span>(<span class="dt">i =</span> <span class="dv">101</span>, <span class="dt">S =</span> S)</a></code></pre></div>
<p>Well now here are the results:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">S_disease<span class="op">$</span>Sim<span class="op">$</span>CM_Leaf[<span class="dv">101</span>]</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="co">#&gt; [1] 10.00102</span></a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">S_disease<span class="op">$</span>Sim<span class="op">$</span>LAI[<span class="dv">101</span>]</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co">#&gt; [1] 0.2339195</span></a></code></pre></div>
<p>If we want to see the impact of the disease on this day, we can put the results in a new object and plot the results against the first simulation outputs:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">S=<span class="st"> </span><span class="kw"><a href="../reference/dynacof.jl.html">dynacof.jl</a></span>(<span class="dt">Inpath=</span> <span class="kw"><a href="https://rdrr.io/r/base/basename.html">dirname</a></span>(met_file),<span class="dt">FileName=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">Site=</span><span class="st">"package"</span>,<span class="dt">Meteo=</span><span class="kw"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(met_file),<span class="dt">Soil=</span><span class="st">"package"</span>,<span class="dt">Coffee=</span><span class="st">"package"</span>,<span class="dt">Tree=</span><span class="ot">NULL</span>))</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="co">#&gt;  Simulation completed successfully</span></a>
<a class="sourceLine" id="cb19-4" title="4"></a>
<a class="sourceLine" id="cb19-5" title="5">S_disease=<span class="st"> </span>S</a>
<a class="sourceLine" id="cb19-6" title="6">S_disease<span class="op">$</span>Sim<span class="op">$</span>CM_Leaf[<span class="dv">100</span>]=<span class="st"> </span>S_disease<span class="op">$</span>Sim<span class="op">$</span>CM_Leaf[<span class="dv">100</span>] <span class="op">*</span><span class="st"> </span>(<span class="fl">1.0</span> <span class="op">-</span><span class="st"> </span><span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb19-7" title="7">S_disease=<span class="st"> </span><span class="kw"><a href="../reference/dynacof_i.jl.html">dynacof_i.jl</a></span>(<span class="dt">i =</span> <span class="dv">101</span><span class="op">:</span><span class="dv">200</span>, <span class="dt">S =</span> S_disease)</a>
<a class="sourceLine" id="cb19-8" title="8"></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="kw">bind_cols</span>(<span class="dt">Date=</span> S<span class="op">$</span>Meteo<span class="op">$</span>Date,<span class="dt">LAI=</span> S<span class="op">$</span>Sim<span class="op">$</span>LAI,<span class="dt">LAI_disease=</span> S_disease<span class="op">$</span>Sim<span class="op">$</span>LAI)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">50</span><span class="op">:</span><span class="dv">200</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-11" title="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y=</span> LAI, <span class="dt">x=</span> Date))<span class="op">+</span></a>
<a class="sourceLine" id="cb19-12" title="12"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color=</span> <span class="st">"no disease"</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb19-13" title="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span> LAI_disease,<span class="dt">color=</span> <span class="st">"Disease event on day 100"</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb19-14" title="14"><span class="st">  </span><span class="kw">theme_tufte</span>()</a></code></pre></div>
<p><img src="julia-version_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>The result is quite obvious: the disease impacted the LAI of the coffee by decreasing its value rapidly on day 101, and then the coffee grew again but its LAI remained lower than the other.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#install-julia">Install Julia</a></li>
      <li><a href="#setup-julia-from-r">Setup Julia from R</a></li>
      <li><a href="#making-a-dynacof-simulation">Making a DynACof simulation</a></li>
      <li><a href="#use-custom-input-files">Use custom input files</a></li>
      <li><a href="#microbenchmark">Microbenchmark</a></li>
      <li><a href="#calling-dynacof-step-by-step">Calling DynACof step by step</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://remi-vezy.netlify.com">Remi Vezy</a>, <a href="https://www.researchgate.net/profile/Olivier_Roupsard">Olivier Roupsard</a>, <a href="https://www.researchgate.net/profile/Guerric_Le_Maire">Guerric le Maire</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
